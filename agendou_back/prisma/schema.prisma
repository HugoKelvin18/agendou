// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id                       Int               @id @default(autoincrement())
  nome                     String
  email                    String            @unique
  senha                    String
  telefone                 String?
  role                     Role              @default(CLIENTE)
  mensagemPublica          String?
  cidade                   String?
  bairro                   String?
  endereco                 String?
  numero                   String?
  complemento              String?
  uf                       String?
  cep                      String?
  whatsapp                 String?
  emailPublico             String?
  instagram                String?
  facebook                 String?
  tiktok                   String?
  site                     String?
  linkedin                 String?
  createdAt                DateTime          @default(now())
  updatedAt                DateTime          @updatedAt
  servicos                 Servico[]         @relation("ProfissionalServicos")
  agendamentosCliente      Agendamento[]     @relation("ClienteAgendamentos")
  agendamentosProfissional Agendamento[]     @relation("ProfissionalAgendamentos")
  disponibilidades         Disponibilidade[] @relation("ProfissionalDisponibilidades")
  notificacoesLidas        NotificacaoLida[]

  @@map("usuarios")
}

model Servico {
  id             Int      @id @default(autoincrement())
  nome           String
  descricao      String
  preco          Float
  duracao        Int // em minutos
  imagemUrl      String?
  profissionalId Int
  ativo          Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relações
  profissional Usuario       @relation("ProfissionalServicos", fields: [profissionalId], references: [id], onDelete: Cascade)
  agendamentos Agendamento[]

  @@map("servicos")
}

model Disponibilidade {
  id             Int      @id @default(autoincrement())
  profissionalId Int
  data           DateTime
  horaInicio     Int // em minutos desde meia-noite
  horaFim        Int // em minutos desde meia-noite
  intervaloMin   Int      @default(30) // intervalo mínimo entre agendamentos
  disponivel     Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relações
  profissional Usuario @relation("ProfissionalDisponibilidades", fields: [profissionalId], references: [id], onDelete: Cascade)

  @@map("disponibilidades")
}

model Agendamento {
  id             Int               @id @default(autoincrement())
  clienteId      Int
  profissionalId Int
  servicoId      Int
  data           DateTime
  hora           String // formato "HH:mm"
  status         StatusAgendamento @default(PENDENTE)
  criadoEm       DateTime          @default(now())
  atualizadoEm   DateTime          @updatedAt

  // Relações
  cliente      Usuario @relation("ClienteAgendamentos", fields: [clienteId], references: [id], onDelete: Cascade)
  profissional Usuario @relation("ProfissionalAgendamentos", fields: [profissionalId], references: [id], onDelete: Cascade)
  servico      Servico @relation(fields: [servicoId], references: [id], onDelete: Restrict)

  @@map("agendamentos")
}

model NotificacaoLida {
  id            Int      @id @default(autoincrement())
  usuarioId     Int
  notificacaoId String // ID da notificação (pode ser "app-1", "msg-2", etc.)
  createdAt     DateTime @default(now())

  // Relações
  usuario Usuario @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@unique([usuarioId, notificacaoId])
  @@map("notificacoes_lidas")
}

model CodigoAcesso {
  id        Int       @id @default(autoincrement())
  codigo    String    @unique
  ativo     Boolean   @default(true)
  expiraEm  DateTime? // Opcional: data de expiração
  descricao String? // Opcional: descrição do código
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@map("codigos_acesso")
}

enum Role {
  CLIENTE
  PROFISSIONAL
}

enum StatusAgendamento {
  PENDENTE
  EM_ANDAMENTO
  CONCLUIDO
  CANCELADO
}
